{"dependencies":[{"name":"BatchedBridge","isAsync":false},{"name":"EventEmitter","isAsync":false},{"name":"Set","isAsync":false},{"name":"TaskQueue","isAsync":false},{"name":"infoLog","isAsync":false},{"name":"fbjs/lib/invariant","isAsync":false},{"name":"fbjs/lib/keyMirror","isAsync":false}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, module, exports, _dependencyMap) {\n  'use strict';\n\n  var BatchedBridge = _$$_REQUIRE(_dependencyMap[0], 'BatchedBridge');\n\n  var EventEmitter = _$$_REQUIRE(_dependencyMap[1], 'EventEmitter');\n\n  var Set = _$$_REQUIRE(_dependencyMap[2], 'Set');\n\n  var TaskQueue = _$$_REQUIRE(_dependencyMap[3], 'TaskQueue');\n\n  var infoLog = _$$_REQUIRE(_dependencyMap[4], 'infoLog');\n\n  var invariant = _$$_REQUIRE(_dependencyMap[5], 'fbjs/lib/invariant');\n\n  var keyMirror = _$$_REQUIRE(_dependencyMap[6], 'fbjs/lib/keyMirror');\n\n  var _emitter = new EventEmitter();\n\n  var DEBUG_DELAY = 0;\n  var DEBUG = false;\n  var InteractionManager = {\n    Events: keyMirror({\n      interactionStart: true,\n      interactionComplete: true\n    }),\n    runAfterInteractions: function runAfterInteractions(task) {\n      var tasks = [];\n      var promise = new Promise(function (resolve) {\n        _scheduleUpdate();\n\n        if (task) {\n          tasks.push(task);\n        }\n\n        tasks.push({\n          run: resolve,\n          name: 'resolve ' + (task && task.name || '?')\n        });\n\n        _taskQueue.enqueueTasks(tasks);\n      });\n      return {\n        then: promise.then.bind(promise),\n        done: function done() {\n          if (promise.done) {\n            return promise.done.apply(promise, arguments);\n          } else {\n            console.warn('Tried to call done when not supported by current Promise implementation.');\n          }\n        },\n        cancel: function cancel() {\n          _taskQueue.cancelTasks(tasks);\n        }\n      };\n    },\n    createInteractionHandle: function createInteractionHandle() {\n      DEBUG && infoLog('create interaction handle');\n\n      _scheduleUpdate();\n\n      var handle = ++_inc;\n\n      _addInteractionSet.add(handle);\n\n      return handle;\n    },\n    clearInteractionHandle: function clearInteractionHandle(handle) {\n      DEBUG && infoLog('clear interaction handle');\n      invariant(!!handle, 'Must provide a handle to clear.');\n\n      _scheduleUpdate();\n\n      _addInteractionSet.delete(handle);\n\n      _deleteInteractionSet.add(handle);\n    },\n    addListener: _emitter.addListener.bind(_emitter),\n    setDeadline: function setDeadline(deadline) {\n      _deadline = deadline;\n    }\n  };\n\n  var _interactionSet = new Set();\n\n  var _addInteractionSet = new Set();\n\n  var _deleteInteractionSet = new Set();\n\n  var _taskQueue = new TaskQueue({\n    onMoreTasks: _scheduleUpdate\n  });\n\n  var _nextUpdateHandle = 0;\n  var _inc = 0;\n\n  var _deadline = -1;\n\n  function _scheduleUpdate() {\n    if (!_nextUpdateHandle) {\n      if (_deadline > 0) {\n        _nextUpdateHandle = setTimeout(_processUpdate, 0 + DEBUG_DELAY);\n      } else {\n        _nextUpdateHandle = setImmediate(_processUpdate);\n      }\n    }\n  }\n\n  function _processUpdate() {\n    _nextUpdateHandle = 0;\n    var interactionCount = _interactionSet.size;\n\n    _addInteractionSet.forEach(function (handle) {\n      return _interactionSet.add(handle);\n    });\n\n    _deleteInteractionSet.forEach(function (handle) {\n      return _interactionSet.delete(handle);\n    });\n\n    var nextInteractionCount = _interactionSet.size;\n\n    if (interactionCount !== 0 && nextInteractionCount === 0) {\n      _emitter.emit(InteractionManager.Events.interactionComplete);\n    } else if (interactionCount === 0 && nextInteractionCount !== 0) {\n      _emitter.emit(InteractionManager.Events.interactionStart);\n    }\n\n    if (nextInteractionCount === 0) {\n      while (_taskQueue.hasTasksToProcess()) {\n        _taskQueue.processNext();\n\n        if (_deadline > 0 && BatchedBridge.getEventLoopRunningTime() >= _deadline) {\n          _scheduleUpdate();\n\n          break;\n        }\n      }\n    }\n\n    _addInteractionSet.clear();\n\n    _deleteInteractionSet.clear();\n  }\n\n  module.exports = InteractionManager;\n});","map":[[2,0,11,0],[4,0,13,0],[4,6,13,6,"BatchedBridge"],[4,22,13,22,"require"],[4,53,13,30],[4,68,13,22],[4,69,13,0],[6,0,14,0],[6,6,14,6,"EventEmitter"],[6,21,14,21,"require"],[6,52,14,29],[6,66,14,21],[6,67,14,0],[8,0,15,0],[8,6,15,6,"Set"],[8,12,15,12,"require"],[8,43,15,20],[8,48,15,12],[8,49,15,0],[10,0,16,0],[10,6,16,6,"TaskQueue"],[10,18,16,18,"require"],[10,49,16,26],[10,60,16,18],[10,61,16,0],[12,0,18,0],[12,6,18,6,"infoLog"],[12,16,18,16,"require"],[12,47,18,24],[12,56,18,16],[12,57,18,0],[14,0,19,0],[14,6,19,6,"invariant"],[14,18,19,18,"require"],[14,49,19,26],[14,69,19,18],[14,70,19,0],[16,0,23,0],[16,6,23,6,"keyMirror"],[16,18,23,18,"require"],[16,49,23,26],[16,69,23,18],[16,70,23,0],[18,0,28,0],[18,6,28,6,"_emitter"],[18,17,28,17],[18,21,28,21,"EventEmitter"],[18,33,28,17],[18,35,28,0],[20,0,30,0],[20,6,30,6,"DEBUG_DELAY"],[20,20,30,20],[20,21,30,0],[21,0,31,0],[21,6,31,6,"DEBUG"],[21,14,31,14],[21,19,31,0],[22,0,82,0],[22,6,82,6,"InteractionManager"],[22,27,82,27],[23,0,83,2,"Events"],[23,12,83,10,"keyMirror"],[23,22,83,20],[24,0,84,4,"interactionStart"],[24,24,84,22],[24,28,83,20],[25,0,85,4,"interactionComplete"],[25,27,85,25],[26,0,83,20],[26,5,83,10],[26,6,82,27],[27,0,92,2,"runAfterInteractions"],[27,24,82,27],[27,56,93,4,"task"],[27,60,82,27],[27,62,94,56],[28,0,95,4],[28,10,95,10,"tasks"],[28,18,95,18],[28,20,95,4],[29,0,96,4],[29,10,96,10,"promise"],[29,20,96,20],[29,24,96,24,"Promise"],[29,31,96,20],[29,32,96,32],[29,51,96,43],[30,0,97,6,"_scheduleUpdate"],[32,0,98,6],[32,12,98,10,"task"],[32,16,98,6],[32,18,98,16],[33,0,99,8,"tasks"],[33,16,99,14,"push"],[33,20,99,8],[33,21,99,19,"task"],[33,25,99,8],[34,0,100,7],[36,0,101,6,"tasks"],[36,14,101,12,"push"],[36,18,101,6],[36,19,101,17],[37,0,102,8,"run"],[37,15,102,13,"resolve"],[37,22,101,17],[38,0,103,8,"name"],[38,16,103,14],[38,30,103,29,"task"],[38,38,103,37,"task"],[38,43,103,42,"name"],[38,47,103,28],[38,51,103,51],[38,54,103,14],[39,0,101,17],[39,9,101,6],[41,0,105,6,"_taskQueue"],[41,19,105,17,"enqueueTasks"],[41,31,105,6],[41,32,105,30,"tasks"],[41,37,105,6],[42,0,106,5],[42,7,96,20],[42,8,96,4],[43,0,107,4],[43,13,107,11],[44,0,108,6,"then"],[44,14,108,12,"promise"],[44,22,108,20,"then"],[44,26,108,12],[44,27,108,25,"bind"],[44,31,108,12],[44,32,108,30,"promise"],[44,39,108,12],[44,40,107,11],[45,0,109,6,"done"],[45,14,109,12],[45,30,109,25],[46,0,110,8],[46,14,110,12,"promise"],[46,22,110,20,"done"],[46,26,110,8],[46,28,110,26],[47,0,111,10],[47,19,111,17,"promise"],[47,27,111,25,"done"],[47,31,111,17],[47,57,111,10],[48,0,112,9],[48,11,110,8],[48,17,112,15],[49,0,113,10,"console"],[49,20,113,18,"warn"],[49,24,113,10],[49,25,114,12],[49,99,113,10],[50,0,116,9],[51,0,117,7],[51,9,107,11],[52,0,118,6,"cancel"],[52,16,118,14],[52,34,118,25],[53,0,119,8,"_taskQueue"],[53,21,119,19,"cancelTasks"],[53,32,119,8],[53,33,119,31,"tasks"],[53,38,119,8],[54,0,120,7],[55,0,107,11],[55,7,107,4],[56,0,122,3],[56,5,82,27],[57,0,127,2,"createInteractionHandle"],[57,27,82,27],[57,64,127,36],[58,0,128,4,"DEBUG"],[58,15,128,13,"infoLog"],[58,23,128,21],[58,50,128,13],[58,51,128,4],[60,0,129,4,"_scheduleUpdate"],[62,0,130,4],[62,10,130,10,"handle"],[62,19,130,19],[62,21,130,21,"_inc"],[62,25,130,4],[64,0,131,4,"_addInteractionSet"],[64,25,131,23,"add"],[64,28,131,4],[64,29,131,27,"handle"],[64,35,131,4],[66,0,132,4],[66,13,132,11,"handle"],[66,19,132,4],[67,0,133,3],[67,5,82,27],[68,0,138,2,"clearInteractionHandle"],[68,26,82,27],[68,60,138,25,"handle"],[68,66,82,27],[68,68,138,41],[69,0,139,4,"DEBUG"],[69,15,139,13,"infoLog"],[69,23,139,21],[69,49,139,13],[69,50,139,4],[70,0,140,4,"invariant"],[70,16,140,14],[70,17,140,15],[70,18,140,16,"handle"],[70,24,140,4],[70,26,140,24],[70,59,140,4],[72,0,141,4,"_scheduleUpdate"],[74,0,142,4,"_addInteractionSet"],[74,25,142,23,"delete"],[74,31,142,4],[74,32,142,30,"handle"],[74,38,142,4],[76,0,143,4,"_deleteInteractionSet"],[76,28,143,26,"add"],[76,31,143,4],[76,32,143,30,"handle"],[76,38,143,4],[77,0,144,3],[77,5,82,27],[78,0,146,2,"addListener"],[78,17,146,15,"_emitter"],[78,26,146,24,"addListener"],[78,37,146,15],[78,38,146,36,"bind"],[78,42,146,15],[78,43,146,41,"_emitter"],[78,51,146,15],[78,52,82,27],[79,0,153,2,"setDeadline"],[79,15,82,27],[79,38,153,14,"deadline"],[79,46,82,27],[79,48,153,32],[80,0,154,4,"_deadline"],[80,18,154,16,"deadline"],[80,26,154,4],[81,0,155,3],[82,0,82,27],[82,3,82,0],[84,0,158,0],[84,6,158,6,"_interactionSet"],[84,24,158,24],[84,28,158,28,"Set"],[84,31,158,24],[84,33,158,0],[86,0,159,0],[86,6,159,6,"_addInteractionSet"],[86,27,159,27],[86,31,159,31,"Set"],[86,34,159,27],[86,36,159,0],[88,0,160,0],[88,6,160,6,"_deleteInteractionSet"],[88,30,160,30],[88,34,160,34,"Set"],[88,37,160,30],[88,39,160,0],[90,0,161,0],[90,6,161,6,"_taskQueue"],[90,19,161,19],[90,23,161,23,"TaskQueue"],[90,32,161,19],[90,33,161,33],[91,0,161,34,"onMoreTasks"],[91,17,161,47,"_scheduleUpdate"],[92,0,161,33],[92,3,161,19],[92,4,161,0],[94,0,162,0],[94,6,162,4,"_nextUpdateHandle"],[94,26,162,24],[94,27,162,0],[95,0,163,0],[95,6,163,4,"_inc"],[95,13,163,11],[95,14,163,0],[97,0,164,0],[97,6,164,4,"_deadline"],[97,18,164,16],[97,19,164,17],[97,20,164,0],[99,0,171,0],[99,11,171,9,"_scheduleUpdate"],[99,26,171,0],[99,29,171,27],[100,0,172,2],[100,8,172,6],[100,9,172,7,"_nextUpdateHandle"],[100,26,172,2],[100,28,172,26],[101,0,173,4],[101,10,173,8,"_deadline"],[101,22,173,20],[101,23,173,4],[101,25,173,23],[102,0,177,6,"_nextUpdateHandle"],[102,28,177,26,"setTimeout"],[102,39,177,37,"_processUpdate"],[102,53,177,26],[102,55,177,53],[102,59,177,57,"DEBUG_DELAY"],[102,70,177,26],[102,71,177,6],[103,0,178,5],[103,7,173,4],[103,13,178,11],[104,0,179,6,"_nextUpdateHandle"],[104,28,179,26,"setImmediate"],[104,41,179,39,"_processUpdate"],[104,55,179,26],[104,56,179,6],[105,0,180,5],[106,0,181,3],[107,0,182,1],[109,0,187,0],[109,11,187,9,"_processUpdate"],[109,25,187,0],[109,28,187,26],[110,0,188,2,"_nextUpdateHandle"],[110,24,188,22],[110,25,188,2],[111,0,190,2],[111,8,190,8,"interactionCount"],[111,27,190,27,"_interactionSet"],[111,43,190,43,"size"],[111,47,190,2],[113,0,191,2,"_addInteractionSet"],[113,23,191,21,"forEach"],[113,30,191,2],[113,31,191,29],[114,0,191,29],[114,13,191,39,"_interactionSet"],[114,29,191,55,"add"],[114,32,191,39],[114,33,191,59,"handle"],[114,39,191,39],[114,40,191,29],[115,0,191,29],[115,5,191,2],[117,0,192,2,"_deleteInteractionSet"],[117,26,192,24,"forEach"],[117,33,192,2],[117,34,192,32],[118,0,192,32],[118,13,192,42,"_interactionSet"],[118,29,192,58,"delete"],[118,35,192,42],[118,36,192,65,"handle"],[118,42,192,42],[118,43,192,32],[119,0,192,32],[119,5,192,2],[121,0,193,2],[121,8,193,8,"nextInteractionCount"],[121,31,193,31,"_interactionSet"],[121,47,193,47,"size"],[121,51,193,2],[123,0,195,2],[123,8,195,6,"interactionCount"],[123,29,195,27],[123,30,195,6],[123,34,195,32,"nextInteractionCount"],[123,59,195,57],[123,60,195,2],[123,62,195,60],[124,0,197,4,"_emitter"],[124,15,197,13,"emit"],[124,19,197,4],[124,20,197,18,"InteractionManager"],[124,39,197,37,"Events"],[124,45,197,18],[124,46,197,44,"interactionComplete"],[124,65,197,4],[125,0,198,3],[125,5,195,2],[125,11,198,9],[125,15,198,13,"interactionCount"],[125,36,198,34],[125,37,198,13],[125,41,198,39,"nextInteractionCount"],[125,66,198,64],[125,67,198,9],[125,69,198,67],[126,0,200,4,"_emitter"],[126,15,200,13,"emit"],[126,19,200,4],[126,20,200,18,"InteractionManager"],[126,39,200,37,"Events"],[126,45,200,18],[126,46,200,44,"interactionStart"],[126,62,200,4],[127,0,201,3],[129,0,204,2],[129,8,204,6,"nextInteractionCount"],[129,33,204,31],[129,34,204,2],[129,36,204,34],[130,0,205,4],[130,13,205,11,"_taskQueue"],[130,24,205,22,"hasTasksToProcess"],[130,41,205,11],[130,43,205,4],[130,45,205,43],[131,0,206,6,"_taskQueue"],[131,19,206,17,"processNext"],[131,30,206,6],[133,0,207,6],[133,12,208,8,"_deadline"],[133,24,208,20],[133,25,208,8],[133,29,209,8,"BatchedBridge"],[133,43,209,22,"getEventLoopRunningTime"],[133,66,209,8],[133,72,209,51,"_deadline"],[133,81,207,6],[133,83,210,8],[134,0,212,8,"_scheduleUpdate"],[136,0,213,8],[137,0,214,7],[138,0,215,5],[139,0,216,3],[141,0,217,2,"_addInteractionSet"],[141,23,217,21,"clear"],[141,28,217,2],[143,0,218,2,"_deleteInteractionSet"],[143,26,218,24,"clear"],[143,31,218,2],[144,0,219,1],[146,0,221,0,"module"],[146,9,221,7,"exports"],[146,16,221,0],[146,19,221,17,"InteractionManager"],[146,37,221,0]]},"type":"js/module"}]}